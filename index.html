<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BoringClicker</title>
<style>
  :root{
    --bg1: rgba(15,23,36,0.72);
    --bg2: rgba(16,42,67,0.72);
    --glass-border: rgba(255,255,255,0.06);
    --muted: #bfc9d9;
    --glass-radius: 14px;
    --accent1: #ffd36b;
    --accent2: #ff8ab6;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
  body{
    background:
      radial-gradient(1200px 600px at 10% 10%, rgba(255,138,182,0.06), transparent 8%),
      linear-gradient(180deg, var(--bg1), var(--bg2)),
      url('SpaceBackground.jfif');
    background-blend-mode: overlay, overlay, normal;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    color:#e6eef8;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:36px;
    min-height:100vh;
  }

  /* Top settings button */
  #settingsBtn{
    position:fixed;
    top:12px;
    right:14px;
    z-index:9998;
    background: rgba(0,0,0,0.28);
    border:1px solid rgba(255,255,255,0.06);
    color:#eaf2ff;
    padding:10px 12px;
    border-radius:10px;
    cursor:pointer;
    backdrop-filter: blur(4px);
    box-shadow: 0 6px 18px rgba(2,6,23,0.6);
    font-weight:700;
  }

  /* Loading overlay */
  #loadingOverlay{
    position:fixed;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    background:linear-gradient(180deg, rgba(2,6,23,0.92), rgba(2,6,23,0.95));
    z-index:9999;
    flex-direction:column;
    gap:18px;
    color:#eaf2ff;
  }
  #loadingBox{
    width:520px;
    max-width:90%;
    padding:18px;
    border-radius:12px;
    background: rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.05);
    text-align:center;
  }
  #loadingBarWrap{
    width:100%;
    background: rgba(255,255,255,0.03);
    border-radius:12px;
    padding:6px;
    margin-top:12px;
  }
  #loadingBar{
    height:14px;
    width:0%;
    border-radius:8px;
    background: linear-gradient(90deg, var(--accent1), var(--accent2));
    transition: width 300ms ease;
  }

  /* Main container */
  #gameWrap{
    width:100%;
    max-width:1080px;
    display:flex;
    gap:28px;
    align-items:flex-start;
    z-index:1;
  }

  .panel{
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
    border:1px solid var(--glass-border);
    backdrop-filter: blur(6px);
    padding:18px;
    border-radius: var(--glass-radius);
    box-shadow: 0 8px 30px rgba(2,6,23,0.55);
  }

  /* Left panel */
  #leftPanel{
    width:380px;
    display:flex;
    flex-direction:column;
    gap:12px;
  }
  .titleRow{display:flex;align-items:center;justify-content:space-between}
  h1{margin:0;font-size:20px;letter-spacing:0.6px}
  .sub{color:var(--muted);font-size:13px}

  #totalCookies{font-size:34px;margin-top:6px;font-weight:700;color:#fff;text-shadow: 0 6px 18px rgba(0,0,0,0.6);}

  .metaRow{display:flex;gap:10px;margin-top:6px}
  .meta{background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border: 1px solid rgba(255,255,255,0.03);padding:10px 12px;border-radius:10px;font-size:13px;min-width:120px;text-align:left}
  .meta strong{display:block;font-size:15px;color:#fff}

  /* Upgrades area */
  #upgrades{display:flex;flex-direction:column;gap:8px;margin-top:6px}
  .upgrade{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.015)}
  .upgrade .left{display:flex;flex-direction:column}
  .upgrade .name{font-weight:800}
  .upgrade .desc{font-size:12px;color:var(--muted)}
  .upgrade button{background:transparent;border:1px solid rgba(255,255,255,0.08);color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700}
  .upgrade button.buyable{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#082032;border:none;box-shadow:0 6px 22px rgba(255,138,182,0.12)}

  /* Buildings list - scrollable + styled scrollbar */
  #buildingsWrap{margin-top:10px}
  #buildingsList{
    margin-top:6px;
    display:flex;
    flex-direction:column;
    gap:10px;
    max-height:320px;         /* <-- scrollable area */
    overflow-y:auto;
    padding-right:8px;
  }
  /* custom scrollbar */
  #buildingsList::-webkit-scrollbar{width:10px}
  #buildingsList::-webkit-scrollbar-track{background:transparent}
  #buildingsList::-webkit-scrollbar-thumb{background:linear-gradient(180deg,rgba(255,255,255,0.06),rgba(255,255,255,0.02));border-radius:10px;border:2px solid transparent;background-clip:padding-box}
  /* firefox */
  #buildingsList{scrollbar-width:thin;scrollbar-color: rgba(255,255,255,0.06) transparent}

  .building{display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.015);gap:10px}
  .b-left{display:flex;gap:10px;align-items:center}
  .b-icon{width:52px;height:52px;border-radius:10px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#082032;box-shadow:0 6px 18px rgba(255,138,182,0.08)}
  .b-info{display:flex;flex-direction:column}
  .b-info .name{font-weight:800}
  .b-info .desc{font-size:12px;color:var(--muted)}
  .b-right{display:flex;flex-direction:column;align-items:flex-end;gap:6px}
  .b-cost{font-size:13px;color:var(--muted)}
  .buyBtn{background:transparent;border:1px solid rgba(255,255,255,0.08);color:#fff;padding:6px 10px;border-radius:10px;cursor:pointer;font-weight:700}
  .buyBtn.buyable{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#082032;border:none;box-shadow:0 6px 22px rgba(255,138,182,0.12)}

  /* Right panel */
  #rightPanel{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;width:100%;max-width:660px}
  #starCard{width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:18px 28px;border-radius:18px;background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);box-shadow:0 12px 40px rgba(2,6,23,0.55)}
  #starName{font-weight:800;margin-bottom:10px;color:#fff}
  #cookieBtn{width:260px;max-width:60%;cursor:pointer;user-select:none;transform-origin:center;transition: transform .12s ease, filter .12s ease}
  #cookieBtn:hover{ transform:translateY(-6px) rotate(-2deg) }
  #cookieBtn:active{ transform:scale(.94) rotate(0deg) }

  #starStats{margin-top:14px;display:flex;gap:18px;align-items:center;justify-content:center}
  .stat{text-align:center;padding:8px 14px;border-radius:12px;background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);min-width:140px}
  .stat .label{ font-size:12px; color:var(--muted); }
  .stat .value{ margin-top:6px; font-size:18px; font-weight:800; color:#fff}

  .hint{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}

  /* Settings modal */
  #settingsModal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:99999}
  #settingsCard{background:#071025;padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);width:420px;max-width:92%}
  #settingsCard h3{margin:0 0 8px 0}
  .row{display:flex;align-items:center;justify-content:space-between;margin-top:10px;gap:12px}
  .row label{font-size:13px;color:var(--muted);min-width:140px}
  input[type="range"]{width:100%}
  input[type="text"]{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#eaf2ff}

  @media (max-width:920px){
    #gameWrap{flex-direction:column;align-items:center}
    #leftPanel{width:100%;max-width:680px}
    #rightPanel{width:100%}
    #cookieBtn{width:220px}
    #buildingsList{max-height:260px}
  }
</style>
</head>
<body>
  <button id="settingsBtn" aria-haspopup="dialog">⚙ Settings</button>

  <!-- Loading overlay -->
  <div id="loadingOverlay" role="status" aria-live="polite">
    <div id="loadingBox">
      <div style="font-size:20px;font-weight:800">BoringClicker</div>
      <div style="margin-top:8px;color:var(--muted)">Loading assets — please wait</div>
      <div id="loadingBarWrap"><div id="loadingBar"></div></div>
      <div id="loadingPercent" style="margin-top:8px;color:var(--muted)">0%</div>
    </div>
  </div>

  <!-- Settings modal -->
  <div id="settingsModal" role="dialog" aria-modal="true" aria-hidden="true">
    <div id="settingsCard" class="panel">
      <h3>Settings</h3>
      <div style="font-size:13px;color:var(--muted)">Adjust sound volume and rename your StarCollector.</div>

      <div class="row" style="margin-top:12px">
        <label for="volumeRange">Sound Volume</label>
        <input id="volumeRange" type="range" min="0" max="100" step="1" value="80" />
      </div>

      <div class="row">
        <label for="nameInput">StarCollector name</label>
        <input id="nameInput" type="text" maxlength="20" placeholder="StarCollector" />
      </div>

      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="settingsClose" class="buyBtn">Close</button>
      </div>
    </div>
  </div>

  <!-- Main game (hidden until loaded) -->
  <div id="gameWrap" style="visibility:hidden;opacity:0;transition:opacity .4s ease">
    <!-- LEFT -->
    <div id="leftPanel" class="panel">
      <div class="titleRow">
        <div>
          <h1>BoringClicker</h1>
          <div class="sub">Buy space things — produce cookies per second</div>
        </div>
        <div class="sub" style="text-align:right">v1.5</div>
      </div>

      <div id="totalCookies">0</div>

      <div class="metaRow">
        <div class="meta">
          <div class="label">Cookies</div>
          <strong id="metaTotal">0</strong>
          <div class="cost">Available cookies</div>
        </div>
        <div class="meta">
          <div class="label">Session</div>
          <strong id="metaSession">0</strong>
          <div class="cost">This session</div>
        </div>
      </div>

      <!-- Upgrades -->
      <div style="margin-top:8px">
        <div class="sub" style="margin-bottom:6px">Upgrades</div>
        <div id="upgrades" aria-live="polite">
          <!-- Click upgrade -->
          <div class="upgrade">
            <div class="left">
              <div class="name">Upgrade Click</div>
              <div class="desc">Increase cookies per click by +1 (very expensive, scales fast)</div>
            </div>
            <div>
              <button id="buyClickUpgrade">Buy</button>
            </div>
          </div>

          <!-- Building efficiency -->
          <div class="upgrade">
            <div class="left">
              <div class="name">Building Efficiency</div>
              <div class="desc">Increase all building CPS by +10% per level</div>
            </div>
            <div>
              <button id="buyEffUpgrade">Buy</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Buildings (scrollable) -->
      <div id="buildingsWrap">
        <div class="sub" style="margin-top:10px">Buildings</div>
        <div id="buildingsList" role="list"></div>
      </div>

      <div class="hint">Put <code>StarClickMain.png</code>, <code>SpaceBackground.jfif</code> and <code>ClickSound.mp3</code> beside this file in your repo.</div>
    </div>

    <!-- RIGHT -->
    <div id="rightPanel">
      <div id="starCard" class="panel">
        <div id="starName">StarCollector</div>
        <img id="cookieBtn" src="StarClickMain.png" alt="StarClickMain" draggable="false">
      </div>

      <div id="starStats">
        <div class="stat">
          <div class="label">Cookies / second</div>
          <div class="value" id="cpsValue">0</div>
        </div>
        <div class="stat">
          <div class="label">Cookies / click</div>
          <div class="value" id="cpcValue">1</div>
        </div>
      </div>
    </div>
  </div>

<script>
/* BoringClicker v1.5
 - All building values updated per user's list.
 - registerBuilding helper makes it easy to add new buildings programmatically.
 - formatNumber improved (commas + 'million' display).
 - Keeps audio, settings, loading, rate-limiter, rename, scroll, upgrades, scaling.
*/

/* ---------- ASSET LOADING ---------- */
const assets = ['StarClickMain.png', 'SpaceBackground.jfif', 'ClickSound.mp3'];
let assetsLoaded = 0;
const loadingOverlay = document.getElementById('loadingOverlay');
const loadingBar = document.getElementById('loadingBar');
const loadingPercent = document.getElementById('loadingPercent');
const gameWrap = document.getElementById('gameWrap');

// AUDIO preload
let clickAudio = new Audio('ClickSound.mp3');
clickAudio.preload = 'auto';
clickAudio.crossOrigin = 'anonymous';
clickAudio.addEventListener('canplaythrough', () => { assetsLoaded++; updateLoadingProgress(); revealIfReady(); }, { once: true });
clickAudio.addEventListener('error', () => { console.warn('Click sound failed to load'); assetsLoaded++; updateLoadingProgress(); revealIfReady(); }, { once: true });

// preload images
assets.filter(a => a.endsWith('.png') || a.endsWith('.jfif')).forEach(src => {
  const img = new Image();
  img.src = src;
  img.onload = () => { assetsLoaded++; updateLoadingProgress(); revealIfReady(); };
  img.onerror = () => { console.warn('Asset failed:', src); assetsLoaded++; updateLoadingProgress(); revealIfReady(); };
});
function updateLoadingProgress(){
  const pct = Math.round((assetsLoaded / assets.length) * 100);
  loadingBar.style.width = pct + '%';
  loadingPercent.textContent = pct + '%';
}
function revealIfReady(){
  if (assetsLoaded >= assets.length){
    setTimeout(()=> {
      loadingOverlay.style.transition = 'opacity .4s ease';
      loadingOverlay.style.opacity = 0;
      setTimeout(()=> loadingOverlay.remove(), 420);
      gameWrap.style.visibility = 'visible';
      gameWrap.style.opacity = '1';
    }, 300);
  }
}
setTimeout(()=> {
  if (assetsLoaded < assets.length){
    assetsLoaded = Math.min(assets.length, assetsLoaded + 1);
    updateLoadingProgress();
    revealIfReady();
  }
}, 2000);


/* ---------- GAME STATE ---------- */
let cookies = 0;
let sessionCookies = 0;
let cookiesPerClick = 1; // initial CPC
let clickUpgradeLevel = 0;
let effUpgradeLevel = 0;

// === INITIAL BUILDINGS DEFINITION ===
// Edit this array to add or change buildings easily.
// Each object needs: id (unique), name, baseCost (number), baseCPS (number), desc (string)
const initialBuildings = [
  { id: 'telescope', name: 'Telescope', baseCost: 15,           baseCPS: 0.1,    desc: 'Basic science: small CPS' },
  { id: 'space_rocket', name: 'Space Rocket', baseCost: 200,    baseCPS: 1.25,   desc: 'Rockets launching probes' },
  { id: 'satellite', name: 'Satellite', baseCost: 1100,         baseCPS: 9,      desc: 'Orbiting machines, steady income' },
  { id: 'space_station', name: 'Space Station', baseCost: 12000, baseCPS: 48,     desc: 'Big orbital platform' },
  { id: 'solar_probe', name: 'Solar Probe', baseCost: 130000,   baseCPS: 270,    desc: 'Expensive probes near stars' },
  { id: 'tiny_planet', name: 'Tiny Planet', baseCost: 1_400_000, baseCPS: 1450, desc: 'Small artificial world' },
  { id: 'gas_giant', name: 'Gas Giant', baseCost: 20_000_000,    baseCPS: 7800, desc: 'Huge yields but very expensive' },
  { id: 'alien_megaplanet', name: 'Alien MegaPlanet', baseCost: 330_000_000, baseCPS: 44000, desc: 'Mega investment: massive CPS' }
];

// dynamic arrays used by game
let buildingDefs = [];       // active definitions (populated by registerBuilding)
const buildingsState = {};   // owned counts etc (populated by registerBuilding)

/* registerBuilding makes it simple to add new buildings:
   call registerBuilding({id,name,baseCost,baseCPS,desc})
   it will initialize state and make it appear in the UI.
*/
function registerBuilding(def){
  if (!def || !def.id) throw new Error('Invalid building definition');
  buildingDefs.push(Object.assign({}, def));
  buildingsState[def.id] = { owned: 0 };
}

/* register initial buildings */
initialBuildings.forEach(b => registerBuilding(b));

/* ---------- UI REFERENCES ---------- */
const totalEl = document.getElementById('totalCookies');
const metaTotal = document.getElementById('metaTotal');
const metaSession = document.getElementById('metaSession');
const cpsEl = document.getElementById('cpsValue');
const cpcEl = document.getElementById('cpcValue');
const btn = document.getElementById('cookieBtn');
const buildingsList = document.getElementById('buildingsList');
const starNameEl = document.getElementById('starName');

const buyClickUpgradeBtn = document.getElementById('buyClickUpgrade');
const buyEffUpgradeBtn = document.getElementById('buyEffUpgrade');

const settingsBtn = document.getElementById('settingsBtn');
const settingsModal = document.getElementById('settingsModal');
const settingsClose = document.getElementById('settingsClose');
const volumeRange = document.getElementById('volumeRange');
const nameInput = document.getElementById('nameInput');

/* ---------- SETTINGS ---------- */
const LS_VOLUME = 'bc_volume_v1';
const LS_NAME = 'bc_name_v1';
let volume = Number(localStorage.getItem(LS_VOLUME) ?? 80) / 100;
let starName = localStorage.getItem(LS_NAME) ?? 'StarCollector';
volumeRange.value = Math.round(volume * 100);
nameInput.value = starName;
starNameEl.textContent = starName;

volumeRange.addEventListener('input', (e) => {
  volume = Number(e.target.value) / 100;
  localStorage.setItem(LS_VOLUME, Math.round(volume * 100));
  clickAudio.volume = volume;
});
nameInput.addEventListener('input', (e) => {
  const val = e.target.value.slice(0, 20);
  starName = val || 'StarCollector';
  starNameEl.textContent = starName;
  localStorage.setItem(LS_NAME, starName);
});
settingsBtn.addEventListener('click', () => {
  settingsModal.style.display = 'flex';
  settingsModal.setAttribute('aria-hidden','false');
});
settingsClose.addEventListener('click', () => {
  settingsModal.style.display = 'none';
  settingsModal.setAttribute('aria-hidden','true');
});

/* ---------- NUMBER FORMATTING (commas + million) ---------- */
function formatNumber(n){
  if (!isFinite(n)) return '0';
  const abs = Math.abs(n);
  if (abs < 1000) return Math.floor(n).toString();
  if (abs < 1e6) return Math.floor(n).toLocaleString();         // 15,000 -> "15,000"
  const millions = n / 1e6;
  if (millions < 1000){
    // show up to 2 decimals for non-integer millions
    const rounded = Math.round(millions * 100) / 100;
    return (Number.isInteger(rounded) ? rounded.toLocaleString() : rounded.toFixed(2)) + ' million';
  }
  // thousands of millions (e.g., 1,000,000,000 -> 1,000 million)
  const roundedMillions = Math.round(millions);
  return roundedMillions.toLocaleString() + ' million';
}

/* ---------- GAME FORMULAS ---------- */
// cost scaling: baseCost * scale^owned
const COST_SCALE = 1.17;
function getBuildingCost(def, owned){
  return Math.ceil(def.baseCost * Math.pow(COST_SCALE, owned));
}
function getClickUpgradeCost(level){ return Math.ceil(8000 * Math.pow(3.2, level)); }
function getEffUpgradeCost(level){ return Math.ceil(25000 * Math.pow(2.8, level)); }

// compute CPS
function getBuildingCPS(){
  let total = 0;
  for (const def of buildingDefs){
    total += buildingsState[def.id].owned * def.baseCPS;
  }
  const multiplier = 1 + 0.1 * effUpgradeLevel;
  return total * multiplier;
}
function getCPS(){ return getBuildingCPS(); }

/* ---------- AUDIO RATE LIMITER ---------- */
let soundTimestamps = [];
clickAudio.volume = volume;
clickAudio.loop = false;
function getMaxSoundsPerSecond(){
  const cps = getCPS();
  const v = 12 - Math.floor(Math.log10(cps + 10));
  return Math.max(1, Math.min(12, v));
}
function playSound(){
  const now = Date.now();
  soundTimestamps = soundTimestamps.filter(t => (now - t) <= 1000);
  const maxAllowed = getMaxSoundsPerSecond();
  if (soundTimestamps.length >= maxAllowed) return false;
  soundTimestamps.push(now);
  try {
    const a = clickAudio.cloneNode();
    a.volume = volume;
    a.play().catch(()=>{});
  } catch(e){
    try { clickAudio.currentTime = 0; clickAudio.volume = volume; clickAudio.play().catch(()=>{}); } catch(_) {}
  }
  return true;
}

/* ---------- UI RENDER ---------- */
function renderBuildings(){
  buildingsList.innerHTML = '';
  buildingDefs.forEach(def => {
    const state = buildingsState[def.id];
    const cost = getBuildingCost(def, state.owned);
    const effectivePer = (def.baseCPS * (1 + 0.1 * effUpgradeLevel));
    const b = document.createElement('div');
    b.className = 'building';
    b.innerHTML = `
      <div class="b-left">
        <div class="b-icon" aria-hidden="true">${def.name.split(' ').map(s=>s[0]).slice(0,2).join('')}</div>
        <div class="b-info">
          <div class="name">${def.name}</div>
          <div class="desc">${def.desc}</div>
        </div>
      </div>
      <div class="b-right">
        <div class="b-cost">Cost: <strong>${formatNumber(cost)}</strong></div>
        <div class="b-cost">Gives: <strong>${Number(effectivePer.toFixed(2))}</strong> CPS each</div>
        <div style="display:flex;gap:8px;align-items:center">
          <div style="font-size:13px;color:var(--muted);">Owned: <strong>${state.owned}</strong></div>
          <button class="buyBtn" data-id="${def.id}" data-cost="${cost}">Buy</button>
        </div>
      </div>
    `;
    buildingsList.appendChild(b);
  });
  document.querySelectorAll('.buyBtn').forEach(btnEl=>{
    const id = btnEl.dataset.id;
    const cost = Number(btnEl.dataset.cost);
    btnEl.classList.toggle('buyable', cookies >= cost);
    btnEl.onclick = () => attemptBuy(id);
  });
}

function refreshUI(){
  totalEl.textContent = formatNumber(Math.floor(cookies));
  metaTotal.textContent = formatNumber(Math.floor(cookies));
  metaSession.textContent = formatNumber(Math.floor(sessionCookies));
  cpsEl.textContent = Number(getCPS().toFixed(2));
  cpcEl.textContent = cookiesPerClick;

  const clickCost = getClickUpgradeCost(clickUpgradeLevel);
  buyClickUpgradeBtn.textContent = `Buy (${formatNumber(clickCost)})`;
  buyClickUpgradeBtn.classList.toggle('buyable', cookies >= clickCost);

  const effCost = getEffUpgradeCost(effUpgradeLevel);
  buyEffUpgradeBtn.textContent = `Buy (${formatNumber(effCost)})`;
  buyEffUpgradeBtn.classList.toggle('buyable', cookies >= effCost);

  starNameEl.textContent = starName;

  renderBuildings();
}

/* ---------- INTERACTIONS ---------- */
btn.addEventListener('click', () => {
  btn.style.transform = "scale(0.96)";
  setTimeout(()=> btn.style.transform = "", 120);
  cookies += cookiesPerClick;
  sessionCookies += cookiesPerClick;
  playSound();
  refreshUI();
});

function attemptBuy(id){
  const def = buildingDefs.find(d => d.id === id);
  if (!def) return;
  const state = buildingsState[id];
  const cost = getBuildingCost(def, state.owned);
  if (cookies >= cost){
    cookies -= cost;
    state.owned += 1;
    playSound();
    refreshUI();
  } else {
    const btnEl = document.querySelector(`.buyBtn[data-id="${id}"]`);
    flashButton(btnEl);
  }
}

buyClickUpgradeBtn.addEventListener('click', () => {
  const cost = getClickUpgradeCost(clickUpgradeLevel);
  if (cookies >= cost){
    cookies -= cost;
    clickUpgradeLevel += 1;
    cookiesPerClick += 1;
    playSound();
    refreshUI();
  } else flashButton(buyClickUpgradeBtn);
});

buyEffUpgradeBtn.addEventListener('click', () => {
  const cost = getEffUpgradeCost(effUpgradeLevel);
  if (cookies >= cost){
    cookies -= cost;
    effUpgradeLevel += 1;
    playSound();
    refreshUI();
  } else flashButton(buyEffUpgradeBtn);
});

function flashButton(el){
  if (!el) return;
  el.style.transform = "translateY(-4px)";
  el.style.boxShadow = "0 8px 22px rgba(255,0,80,0.08)";
  setTimeout(()=> { el.style.transform=""; el.style.boxShadow=""; }, 220);
}

/* ---------- PASSIVE CPS TICK ---------- */
setInterval(() => {
  const cps = getCPS();
  if (cps > 0){
    cookies += cps;
    sessionCookies += cps;
    // occasional passive sound (rate-limited)
    if (cps >= 500) playSound();
    refreshUI();
  } else refreshUI();
}, 1000);

/* ---------- INIT ---------- */
renderBuildings();
refreshUI();
clickAudio.volume = volume;

// keyboard & modal helpers
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    settingsModal.style.display = 'none';
    settingsModal.setAttribute('aria-hidden','true');
  }
});
nameInput.addEventListener('blur', () => { localStorage.setItem(LS_NAME, nameInput.value.slice(0,20) || 'StarCollector'); });
settingsModal.addEventListener('click', (e) => { if (e.target === settingsModal) { settingsModal.style.display = 'none'; settingsModal.setAttribute('aria-hidden','true'); } });

/* ---------- HOW TO ADD NEW BUILDINGS (dev notes) ----------
  - To add a building at development time, edit initialBuildings above.
  - To add a building dynamically at runtime, call:
      registerBuilding({
         id: 'new_id',
         name: 'New Thing',
         baseCost: 500000,
         baseCPS: 250,
         desc: 'A short description'
      });
    Then call refreshUI() to show it.
  - Costs scale automatically using COST_SCALE (1.17 by default).
---------------------------------------------------------------- */

</script>
</body>
</html>
